# Leveraging eBPF/XDP for Real-Time Machine Learning Traffic Classification in 5G User Plane Networks

This repository maintain the codes from the article "Leveraging eBPF/XDP for Real-Time Machine Learning Traffic Classification in 5G User Plane Networks".

You will find the directories separated by classification type: kernel_class and user_class (kernel-space and user-space classification, respectively).

- #### Kernel space

  In the kernel_class directory you will find three files:
    - *monitorjanela.py*:  This is the user-space code. It acts as a manager and performs the following functions:
      
      1- Compiles and loads the BPF program into the kernel.
      
      2- Attaches the XDP program to the network interface.
      
      3- Populates the PROG_ARRAY used for tail calls.
      
      4- Reads the buffer (perf_buffer) and formats the received events for display in the terminal.

  - *monitorjanela.bpf.c*:  This is the kernel-space code. Its main functions are:

    1- Decapsulates the Ethernet, IP, UDP, and GTP-U headers to access the user’s inner IP address.

    2- Computes the mean and variance of the Inter-Arrival Time (IAT) within a 500 ms window.

    3- Uses tail calls to execute the decision trees of the model (*model500msJANELA.h*).

    4- Sends the classification results and metadata to user space.

  - *model500msJANELA.h*: This is the header file generated by emlearn, which contains the decision tree structures and the prediction functions used by the C code.
    
- #### User space
  
  In the user_class directory you will find five files:
    - *monitor.py*:  This is the user-space code. It acts as a manager and performs the following main functions:
      
      1- Compiles and loads the BPF program into the kernel.
      
      2- Attaches the XDP program to the network interface.
      
      3- Receives events via perf_buffer.
      
      4- Every 500 ms, computes the mean and variance and invokes the C library (libclassifier.so) to obtain the classification.

  - *monitor.bpf.c*:  This is the kernel-space code. Its main functions are:
    
    1- Decapsulates the Ethernet, IP, UDP, and GTP-U headers to access the user’s inner IP address.

    2- Computes the Inter-Arrival Time (IAT).

    3- Sends the metadata to user space.

    *In contrast to the kernel-space classifier, the eBPF code here acts only as a metric collector, forwarding data to user space for classification.* 

  - *model500msJANELA.h*: This is the header file generated by emlearn, which contains the structure of the decision trees.
    
  - *wrapper.c*: This code serves as an adaptation bridge, allowing the model generated by emlearn (in C) to receive data and be executed directly by *monitor.py*.

  - *libclassifier.so*: The shared library compiled from *wrapper.c*.
